{"version":3,"file":"index.esm.js","sources":["../node_modules/style-inject/dist/style-inject.es.js","../src/components/GrammarRectifier.js","../src/utils/api.js"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import React, { useState, useEffect, useRef, cloneElement } from 'react';\r\nimport './GrammarRectifier.css';\r\n\r\nconst GrammarRectifier = ({ children }) => {\r\n  const [text, setText] = useState('');\r\n  const [errors, setErrors] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [hoveredError, setHoveredError] = useState(null);\r\n  const [hoverPosition, setHoverPosition] = useState({ x: 0, y: 0 });\r\n\r\n  const inputRef = useRef(null);\r\n  const overlayRef = useRef(null);\r\n\r\n  const checkGrammar = async (inputText) => {\r\n    try {\r\n      const response = await fetch('http://127.0.0.1:5555/api/check', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ text: inputText }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error ${response.status}`);\r\n      }\r\n\r\n      const result = await response.json();\r\n\r\n      const mappedErrors = (result.errors || []).map(err => ({\r\n        bad: err.bad,\r\n        message: err.message,\r\n        suggestions: err.suggestions || [],\r\n        offset: err.offset,\r\n        length: err.length\r\n      }));\r\n\r\n      return { errors: mappedErrors };\r\n    } catch (error) {\r\n      console.error('API request failed:', error);\r\n      return { errors: [] };\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (text.length > 0) {\r\n      setLoading(true);\r\n      const timer = setTimeout(async () => {\r\n        try {\r\n          const result = await checkGrammar(text);\r\n          setErrors(result.errors || []);\r\n        } catch (err) {\r\n          console.error('Grammar check failed:', err);\r\n          setErrors([]);\r\n        } finally {\r\n          setLoading(false);\r\n        }\r\n      }, 600); \r\n      return () => clearTimeout(timer);\r\n    } else {\r\n      setErrors([]);\r\n    }\r\n  }, [text]);\r\n\r\n  const getTextWithHighlights = () => {\r\n    if (errors.length === 0) return text;\r\n\r\n    let highlightedText = text;\r\n    const sortedErrors = [...errors].sort((a, b) => b.offset - a.offset);\r\n\r\n    sortedErrors.forEach((error) => {\r\n      const beforeError = highlightedText.substring(0, error.offset);\r\n      const errorText = highlightedText.substring(error.offset, error.offset + error.length);\r\n      const afterError = highlightedText.substring(error.offset + error.length);\r\n\r\n      highlightedText =\r\n        beforeError +\r\n        `<span class=\"grammar-error\" data-error=\"${error.bad}\" data-suggestions=\"${error.suggestions.join(',')}\" data-message=\"${error.message}\">${errorText}</span>` +\r\n        afterError;\r\n    });\r\n\r\n    return highlightedText;\r\n  };\r\n\r\n  const handleMouseMove = (e) => {\r\n    if (e.target.classList.contains('grammar-error')) {\r\n      const errorWord = e.target.getAttribute('data-error');\r\n      const suggestions = e.target.getAttribute('data-suggestions').split(',').filter(s => s);\r\n      const message = e.target.getAttribute('data-message');\r\n\r\n      setHoveredError({ word: errorWord, suggestions, message });\r\n      \r\n      const rect = e.target.getBoundingClientRect();\r\n      setHoverPosition({ \r\n        x: rect.left + window.scrollX, \r\n        y: rect.bottom + window.scrollY + 5 \r\n      });\r\n    } else {\r\n      setHoveredError(null);\r\n    }\r\n  };\r\n\r\n  const applySuggestion = (suggestion) => {\r\n  if (hoveredError) {\r\n    const errorMatch = errors.find(e => e.bad === hoveredError.word);\r\n    \r\n    if (errorMatch) {\r\n      const start = errorMatch.offset;\r\n      const end = errorMatch.offset + errorMatch.length;\r\n      const newText = text.substring(0, start) + suggestion + text.substring(end);\r\n      setText(newText);\r\n    } else {\r\n      const index = text.indexOf(hoveredError.word);\r\n      if (index !== -1) {\r\n        const newText = text.substring(0, index) + suggestion + text.substring(index + hoveredError.word.length);\r\n        setText(newText);\r\n      }\r\n    }\r\n    setHoveredError(null);\r\n  }\r\n};\r\n\r\n  const syncScroll = () => {\r\n    if (inputRef.current && overlayRef.current) {\r\n      overlayRef.current.scrollTop = inputRef.current.scrollTop;\r\n      overlayRef.current.scrollLeft = inputRef.current.scrollLeft;\r\n    }\r\n  };\r\n\r\n  const enhancedChild = cloneElement(children, {\r\n    ref: inputRef,\r\n    value: text,\r\n    onChange: (e) => setText(e.target.value),\r\n    onScroll: syncScroll,\r\n    className: (children.props.className || '') + ' text-input'\r\n  });\r\n\r\n  return (\r\n    <div className=\"grammar-rectifier\">\r\n      <div className=\"header\">\r\n         {loading && <div className=\"loading-indicator\">Checking...</div>}\r\n      </div>\r\n\r\n      <div className=\"input-container\">\r\n        <div className=\"textarea-wrapper\">\r\n          {enhancedChild}\r\n\r\n          <div\r\n            ref={overlayRef}\r\n            className=\"highlight-overlay\"\r\n            dangerouslySetInnerHTML={{ __html: getTextWithHighlights() }}\r\n            onMouseMove={handleMouseMove}\r\n            onMouseLeave={() => setHoveredError(null)}\r\n          />\r\n        </div>\r\n\r\n        {hoveredError && (\r\n          <div\r\n            className=\"suggestion-tooltip\"\r\n            style={{ left: hoverPosition.x, top: hoverPosition.y }}\r\n          >\r\n            <div className=\"tooltip-message\">{hoveredError.message}</div>\r\n            {hoveredError.suggestions.length > 0 && (\r\n              <div className=\"suggestions\">\r\n                <strong>Suggestions:</strong>\r\n                {hoveredError.suggestions.map((s, i) => (\r\n                  <button key={i} className=\"suggestion-btn\" onClick={() => applySuggestion(s)}>\r\n                    {s}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {errors.length > 0 && (\r\n        <div className=\"error-summary\">Found {errors.length} error{errors.length > 1 ? 's' : ''}</div>\r\n      )}\r\n      {text && errors.length === 0 && !loading && <div className=\"no-errors\">No grammar errors!</div>}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default GrammarRectifier;","const API_URL = 'http://127.0.0.1:5555/api/check';\r\n\r\nexport const checkGrammar = async (text) => {\r\n  try {\r\n    const response = await fetch(API_URL, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({ text }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP error! Status: ${response.status}`);\r\n    }\r\n\r\n    const data = await response.json();\r\n    return data;\r\n  } catch (error) {\r\n    console.error('Error checking grammar:', error);\r\n    throw error;\r\n  }\r\n};\r\n"],"names":["css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","GrammarRectifier","_ref","children","text","setText","useState","errors","setErrors","loading","setLoading","hoveredError","setHoveredError","hoverPosition","setHoverPosition","x","y","inputRef","useRef","overlayRef","useEffect","length","timer","setTimeout","async","result","response","fetch","method","headers","body","JSON","stringify","inputText","ok","Error","concat","status","json","map","err","bad","message","suggestions","offset","error","console","checkGrammar","clearTimeout","enhancedChild","cloneElement","value","onChange","e","target","onScroll","syncScroll","current","scrollTop","scrollLeft","className","props","_jsxs","_jsx","dangerouslySetInnerHTML","__html","getTextWithHighlights","highlightedText","sort","a","b","forEach","beforeError","substring","errorText","afterError","join","onMouseMove","classList","contains","errorWord","getAttribute","split","filter","s","word","rect","getBoundingClientRect","left","window","scrollX","bottom","scrollY","onMouseLeave","top","i","onClick","suggestion","errorMatch","find","start","end","newText","index","indexOf","applySuggestion"],"mappings":"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"}