import{useState as t,useRef as r,useEffect as o,cloneElement as n}from"react";import{jsxs as e,jsx as a}from"react/jsx-runtime";!function(t,r){void 0===r&&(r={});var o=r.insertAt;if(t&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],e=document.createElement("style");e.type="text/css","top"===o&&n.firstChild?n.insertBefore(e,n.firstChild):n.appendChild(e),e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}}('.grammar-checker{font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif!important;margin:20px auto!important;max-width:800px!important;padding:20px!important}.header{align-items:center!important;display:flex!important;justify-content:space-between!important;margin-bottom:20px!important}.header h2{color:#333!important;margin:0!important}.loading-indicator{color:#2196f3!important;font-size:14px!important;font-weight:500!important}.input-container{margin-bottom:20px!important;position:relative!important}.text-input,.textarea-wrapper{position:relative!important;width:100%!important}.text-input{background:#fff!important;border:2px solid #ddd!important;border-radius:8px!important;box-sizing:border-box!important;color:#333!important;font-family:inherit!important;font-size:16px!important;line-height:1.5!important;min-height:200px!important;padding:12px!important;resize:vertical!important;z-index:1!important}.text-input:focus{border-color:#2196f3!important;outline:none!important}.highlight-overlay{word-wrap:break-word!important;border:2px solid #0000!important;border-radius:8px!important;bottom:0!important;box-sizing:border-box!important;color:#0000!important;font-family:inherit!important;font-size:16px!important;left:0!important;line-height:1.5!important;margin:0!important;overflow:hidden!important;padding:12px!important;pointer-events:none!important;position:absolute!important;right:0!important;top:0!important;white-space:pre-wrap!important;z-index:2!important}.grammar-error{background:#0000!important;border-radius:2px!important;color:#333!important;cursor:pointer!important;display:inline!important;pointer-events:auto!important;position:static!important;text-decoration:underline!important;text-decoration-color:red!important;text-decoration-style:wavy!important;text-underline-offset:2px!important;transition:background-color .2s ease!important;vertical-align:initial!important;white-space:pre-wrap!important}.grammar-error:hover{background-color:#ff00001a!important}.suggestion-tooltip{background:#333!important;border-radius:8px!important;box-shadow:0 4px 12px #0000004d!important;color:#fff!important;font-size:14px!important;max-width:280px!important;padding:12px!important;pointer-events:auto!important;position:fixed!important;z-index:1000!important}.suggestion-tooltip:before{border:6px solid!important;border-color:#0000 #0000 #333!important;content:""!important;left:20px!important;position:absolute!important;top:-6px!important}.tooltip-message{color:#e0e0e0!important;font-size:13px!important;margin-bottom:10px!important}.suggestions{margin-top:8px!important}.suggestions strong{color:#fff!important;display:block!important;margin-bottom:6px!important}.suggestion-btn{background:#2196f3!important;border:none!important;border-radius:4px!important;color:#fff!important;cursor:pointer!important;font-size:12px!important;margin:2px 6px 2px 0!important;padding:6px 10px!important;transition:background-color .2s ease!important}.suggestion-btn:hover{background:#1976d2!important;transform:translateY(-1px)!important}.suggestion-btn:active{transform:translateY(0)!important}.error-summary{background-color:#fff3cd!important;border:1px solid #ffeaa7!important;border-radius:6px!important;color:#856404!important;margin-bottom:10px!important}.error-summary,.no-errors{font-weight:500!important;padding:12px!important}.no-errors{background-color:#d4edda!important;border:1px solid #c3e6cb!important;border-radius:6px!important;color:#155724!important}');const i=i=>{let{children:s}=i;const[p,m]=t(""),[c,l]=t([]),[d,g]=t(!1),[u,f]=t(null),[h,x]=t({x:0,y:0}),b=r(null),y=r(null);o(()=>{if(p.length>0){g(!0);const t=setTimeout(async()=>{try{const t=await(async t=>{try{const r=await fetch("http://127.0.0.1:5555/api/check",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:t})});if(!r.ok)throw new Error("HTTP error ".concat(r.status));return{errors:((await r.json()).errors||[]).map(t=>({bad:t.bad,message:t.message,suggestions:t.suggestions||[],offset:t.offset,length:t.length}))}}catch(t){return console.error("API request failed:",t),{errors:[]}}})(p);l(t.errors||[])}catch(t){console.error("Grammar check failed:",t),l([])}finally{g(!1)}},600);return()=>clearTimeout(t)}l([])},[p]);const w=n(s,{ref:b,value:p,onChange:t=>m(t.target.value),onScroll:()=>{b.current&&y.current&&(y.current.scrollTop=b.current.scrollTop,y.current.scrollLeft=b.current.scrollLeft)},className:(s.props.className||"")+" text-input"});return e("div",{className:"grammar-rectifier",children:[a("div",{className:"header",children:d&&a("div",{className:"loading-indicator",children:"Checking..."})}),e("div",{className:"input-container",children:[e("div",{className:"textarea-wrapper",children:[w,a("div",{ref:y,className:"highlight-overlay",dangerouslySetInnerHTML:{__html:(()=>{if(0===c.length)return p;let t=p;return[...c].sort((t,r)=>r.offset-t.offset).forEach(r=>{const o=t.substring(0,r.offset),n=t.substring(r.offset,r.offset+r.length),e=t.substring(r.offset+r.length);t=o+'<span class="grammar-error" data-error="'.concat(r.bad,'" data-suggestions="').concat(r.suggestions.join(","),'" data-message="').concat(r.message,'">').concat(n,"</span>")+e}),t})()},onMouseMove:t=>{if(t.target.classList.contains("grammar-error")){const r=t.target.getAttribute("data-error"),o=t.target.getAttribute("data-suggestions").split(",").filter(t=>t),n=t.target.getAttribute("data-message");f({word:r,suggestions:o,message:n});const e=t.target.getBoundingClientRect();x({x:e.left+window.scrollX,y:e.bottom+window.scrollY+5})}else f(null)},onMouseLeave:()=>f(null)})]}),u&&e("div",{className:"suggestion-tooltip",style:{left:h.x,top:h.y},children:[a("div",{className:"tooltip-message",children:u.message}),u.suggestions.length>0&&e("div",{className:"suggestions",children:[a("strong",{children:"Suggestions:"}),u.suggestions.map((t,r)=>a("button",{className:"suggestion-btn",onClick:()=>(t=>{if(u){const r=c.find(t=>t.bad===u.word);if(r){const o=r.offset,n=r.offset+r.length,e=p.substring(0,o)+t+p.substring(n);m(e)}else{const r=p.indexOf(u.word);if(-1!==r){const o=p.substring(0,r)+t+p.substring(r+u.word.length);m(o)}}f(null)}})(t),children:t},r))]})]})]}),c.length>0&&e("div",{className:"error-summary",children:["Found ",c.length," error",c.length>1?"s":""]}),p&&0===c.length&&!d&&a("div",{className:"no-errors",children:"No grammar errors!"})]})},s=async t=>{try{const r=await fetch("http://127.0.0.1:5555/api/check",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:t})});if(!r.ok)throw new Error("HTTP error! Status: ".concat(r.status));return await r.json()}catch(t){throw console.error("Error checking grammar:",t),t}};export{i as GrammarRectifier,s as checkGrammar};
//# sourceMappingURL=index.esm.js.map
